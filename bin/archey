#!/bin/bash

# System Variables
User=$(whoami)
Hostname=$(system_profiler SPSoftwareDataType | grep "Computer" | sed 's/      Computer Name: //g')
Date=$(date)
IP=`echo $(ifconfig | grep 'inet.*netmask.*broadcast') | awk '{print $2}'`
System_version=$(system_profiler SPSoftwareDataType | grep "System Version" | sed 's/      System Version: //g')
Kernel_version="$(uname) $(uname -r)"
Uptime=$(uptime | sed 's/.*up \([^,]*\), .*/\1/')
Shell="$SHELL"
Terminal="$TERM ${TERM_PROGRAM//_/ }"
Cpu=$(sysctl -n machdep.cpu.brand_string)
Battery=$(ioreg -c AppleSmartBattery -r | awk '$1~/Capacity/{c[$1]=$3} END{OFMT="%.2f%"; max=c["\"MaxCapacity\""]; if (max>0) { print 100*c["\"CurrentCapacity\""]/max;} }')
Ram="$(( $(sysctl -n hw.memsize) / 1024 ** 3  )) GB"
Disk=$(df | head -2 | tail -1 | awk '{print $5}')

# Set up colors if:
# * stdout is a tty
# * the user hasn't turned it off
# * or if we're forcing color
if [[ ( -t 1  && "${opt_nocolor}" = f) || "${opt_force_color}" = t ]]
then
  RED=$(tput       setaf 1 2>/dev/null)
  GREEN=$(tput     setaf 2 2>/dev/null)
  YELLOW=$(tput    setaf 3 2>/dev/null)
  BLUE=$(tput      setaf 4 2>/dev/null)
  PURPLE=$(tput    setaf 5 2>/dev/null)
  textColor=$(tput setaf 6 2>/dev/null)
  normal=$(tput    sgr0 2>/dev/null)
fi

fieldlist[${#fieldlist[@]}]="${textColor}用户名  :${normal} ${User}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}主机名  :${normal} ${Hostname}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}操作系统:${normal} ${System_version}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}内核版本:${normal} ${Kernel_version}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}运行时间:${normal} ${Uptime}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}Shell   :${normal} ${Shell}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}当前终端:${normal} ${Terminal}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}当前时间:${normal} ${Date}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}处理器  :${normal} ${Cpu}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}内存容量:${normal} ${Ram}${normal}"
fieldlist[${#fieldlist[@]}]="${textColor}磁盘占用:${normal} ${Disk}${normal}"
if [[ ! -z $Battery ]]; then
    fieldlist[${#fieldlist[@]}]="${textColor}电量剩余:${normal} ${Battery}${normal}%"
fi
fieldlist[${#fieldlist[@]}]="${textColor}IP 地址 :${normal} ${IP}${normal}"

logofile=${ARCHEY_LOGO_FILE:-"${HOME}/.config/archey-logo"}
if [ -a "$logofile" ]
  then
  source "$logofile"
else
# The ${foo#  } is a cheat so that it lines up here as well
# as when run.
  echo -e "
${GREEN#  }                 ###                  ${fieldlist[0]}
${GREEN#  }               ####                   ${fieldlist[1]}
${GREEN#  }               ###                    ${fieldlist[2]}
${GREEN#  }       #######    #######             ${fieldlist[3]}
${YELLOW# }     ######################           ${fieldlist[4]}
${YELLOW# }    #####################             ${fieldlist[5]}
${RED#    }    ####################              ${fieldlist[6]}
${RED#    }    ####################              ${fieldlist[7]}
${RED#    }    #####################             ${fieldlist[8]}
${PURPLE# }     ######################           ${fieldlist[9]}
${PURPLE# }      ####################            ${fieldlist[10]}
${BLUE#   }        ################              ${fieldlist[11]}
${BLUE#   }         ####     #####               ${fieldlist[12]}
${normal}
"
fi
